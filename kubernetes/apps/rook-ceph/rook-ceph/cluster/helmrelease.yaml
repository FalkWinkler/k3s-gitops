---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: rook-ceph-cluster
  namespace: rook-ceph
spec:
  interval: 30m
  chart:
    spec:
      chart: rook-ceph-cluster
      version: v1.11.7
      sourceRef:
        kind: HelmRepository
        name: rook-ceph
        namespace: flux-system
  values:
    toolbox:
      enabled: true

    ingress:
      dashboard:
        ingressClassName: "nginx"
        annotations:
          hajimari.io/enable: "true"
          hajimari.io/icon: content-save
          hajimari.io/appName: "rook-ceph"

        host:
          name: &host "rook.${SECRET_DOMAIN}"
          path: "/"
        tls:
          - hosts:
              - *host

    monitoring:
      enabled: false
      createPrometheusRules: true

    cephClusterSpec:
      crashCollector:
        disable: false
    mon:
      count: 3
      allowMultiplePerNode: false
    dashboard:
      enabled: true
      urlPrefix: /
      ssl: false

    storage:
      useAllNodes: false
      useAllDevices: false
      config:
        osdsPerDevice: "1"
      nodes:
        - name: "k3s-worker-0"
          devices:
            - name: "sdb"
        - name: "k3s-worker-1"
          devices:
            - name: "sdb"
        - name: "k3s-worker-2"
          devices:
            - name: "sdb"
  cephBlockPoolsVolumeSnapshotClass:
    enabled: true
    name: csi-rbdplugin-snapclass
    annotations:
      k10.kasten.io/is-snapshot-class: "true"
      velero.io/csi-volumesnapshot-class: "true"
